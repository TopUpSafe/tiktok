<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikSave Pro - Fast & Lite</title>
    <meta name="description" content="Download video TikTok tanpa watermark. Versi ringan dan cepat.">
    
    <!-- Fonts: Inter (Lebih umum dan ringan dari Jakarta Sans, sering dicache browser) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', 'sans-serif'],
                    },
                    colors: {
                        // Palet Dark Mode Modern (Mirip Vercel/GitHub Dark)
                        bg: '#0a0a0a',
                        surface: '#171717',
                        border: '#262626',
                        accent: '#EDEDED',
                        muted: '#A1A1AA',
                        brand: '#e11d48', // Pink TikTok yang lebih gelap/elegan
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Reset */
        body {
            background-color: #0a0a0a; /* bg-neutral-950 */
            color: #EDEDED;
            /* Static subtle gradient - Ringan, tidak bergerak */
            background-image: radial-gradient(circle at 50% 0%, #2a1820 0%, transparent 60%);
            background-attachment: fixed;
        }

        /* Utility classes custom untuk performa maksimal (menggantikan backdrop-filter) */
        .card-surface {
            background-color: #171717;
            border: 1px solid #262626;
        }
        
        .input-surface {
            background-color: #0a0a0a;
            border: 1px solid #262626;
        }

        /* Focus ring yang tajam tanpa shadow berat */
        .focus-ring:focus-within {
            border-color: #525252;
            outline: 2px solid transparent;
        }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen">

    <!-- Navbar Minimalis -->
    <nav class="w-full border-b border-border bg-bg/95 z-50">
        <div class="max-w-screen-xl mx-auto px-4 h-14 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <i class="fa-brands fa-tiktok text-brand text-xl"></i>
                <span class="font-bold tracking-tight text-lg">TikSave<span class="text-neutral-500">Lite</span></span>
            </div>
            
            <!-- Status Indikator Statis (Hemat Animasi) -->
            <div id="serverStatus" class="flex items-center gap-2 px-3 py-1 rounded-full bg-surface border border-border text-xs">
                <div class="w-2 h-2 rounded-full bg-neutral-500"></div>
                <span class="text-muted font-medium">Init...</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center justify-center px-4 py-12 sm:px-6">
        
        <div class="w-full max-w-lg space-y-8">
            
            <!-- Text Header -->
            <div class="text-center space-y-2">
                <h1 class="text-3xl sm:text-4xl font-bold tracking-tight text-accent">
                    Video Downloader
                </h1>
                <p class="text-muted text-sm sm:text-base">
                    Tempel tautan, unduh MP4 tanpa watermark.
                </p>
            </div>

            <!-- Main Card -->
            <div class="card-surface rounded-xl p-1 shadow-xl">
                <div class="p-5 space-y-4">
                    
                    <!-- Input Group -->
                    <div class="input-surface rounded-lg p-1 flex items-center gap-2 focus-ring transition-colors">
                        <div class="pl-3 text-muted">
                            <i class="fa-solid fa-link text-sm"></i>
                        </div>
                        <input type="url" id="tiktokUrl" 
                            class="w-full bg-transparent border-none py-3 text-sm text-accent placeholder-neutral-600 focus:ring-0 focus:outline-none" 
                            placeholder="https://vt.tiktok.com/..." autocomplete="off">
                        
                        <button onclick="pasteFromClipboard()" class="hidden md:block px-3 py-1.5 text-xs font-medium text-muted hover:text-accent bg-surface border border-border rounded hover:bg-neutral-800 transition-colors">
                            Paste
                        </button>
                    </div>

                    <!-- Button Paste Mobile -->
                    <button onclick="pasteFromClipboard()" class="md:hidden w-full py-2 text-xs font-medium text-muted bg-surface border border-border rounded hover:bg-neutral-800">
                         Tempel Tautan
                    </button>

                    <!-- Action Button -->
                    <button id="downloadBtn" onclick="processVideo()" disabled
                        class="w-full py-3 px-4 bg-neutral-800 text-neutral-500 rounded-lg font-semibold text-sm transition-all flex items-center justify-center gap-2 cursor-not-allowed">
                        <span id="btnText">Menunggu Server...</span>
                        <!-- Spinner CSS Murni (Lebih ringan dari SVG complex) -->
                        <div id="btnLoader" class="hidden w-4 h-4 border-2 border-neutral-400 border-t-transparent rounded-full animate-spin"></div>
                    </button>

                    <!-- Error Alert -->
                    <div id="errorMessage" class="hidden p-3 bg-red-950/30 border border-red-900/50 rounded-lg flex gap-3">
                        <i class="fa-solid fa-triangle-exclamation text-red-500 text-xs mt-0.5"></i>
                        <p id="errorText" class="text-xs text-red-200">Error message here.</p>
                    </div>
                </div>
            </div>

            <!-- Result Section -->
            <div id="resultContainer" class="hidden">
                <!-- Skeleton (Simple block colors) -->
                <div id="skeletonLoader" class="card-surface rounded-xl p-4 animate-pulse flex gap-4">
                    <div class="w-20 h-28 bg-neutral-800 rounded"></div>
                    <div class="flex-1 space-y-3 py-1">
                        <div class="h-4 bg-neutral-800 rounded w-3/4"></div>
                        <div class="h-3 bg-neutral-800 rounded w-1/2"></div>
                    </div>
                </div>

                <!-- Actual Result -->
                <div id="resultContent" class="hidden card-surface rounded-xl p-4 border border-border">
                    <div class="flex gap-4">
                        <img id="videoThumb" src="" class="w-24 h-auto object-cover rounded bg-neutral-800 border border-border shrink-0">
                        
                        <div class="flex-1 min-w-0 flex flex-col justify-between">
                            <div>
                                <p id="videoAuthor" class="text-xs font-medium text-brand mb-0.5">@Username</p>
                                <h3 id="videoTitle" class="text-sm text-accent line-clamp-2 leading-snug">Title video...</h3>
                            </div>
                            
                            <div class="mt-3 space-y-2">
                                <button id="proxyDownloadBtn" onclick="downloadViaProxy()" 
                                    class="w-full py-2 bg-brand hover:bg-rose-600 text-white text-xs font-bold rounded shadow-sm transition-colors flex items-center justify-center gap-2">
                                    <span id="proxyBtnText">Download HD</span>
                                    <div id="proxyBtnLoader" class="hidden w-3 h-3 border-2 border-white/50 border-t-white rounded-full animate-spin"></div>
                                </button>
                                
                                <a id="fallbackLink" href="#" target="_blank" class="hidden block text-center text-[10px] text-muted underline decoration-dotted">
                                    Link Alternatif
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Features -->
            <div class="grid grid-cols-3 gap-2 text-center pt-4">
                <div class="p-3">
                    <i class="fa-solid fa-gauge-high text-neutral-600 mb-2"></i>
                    <p class="text-[10px] text-muted">Cepat</p>
                </div>
                <div class="p-3">
                    <i class="fa-solid fa-ban text-neutral-600 mb-2"></i>
                    <p class="text-[10px] text-muted">No WM</p>
                </div>
                <div class="p-3">
                    <i class="fa-solid fa-lock text-neutral-600 mb-2"></i>
                    <p class="text-[10px] text-muted">Aman</p>
                </div>
            </div>

        </div>
    </main>

    <footer class="py-6 text-center border-t border-border mt-auto">
        <p class="text-[10px] text-neutral-600">Â© 2024 TikSave Lite. Serverless V4.</p>
    </footer>

    <script>
        // CONFIGURATION
        const API_BASE_URL = "https://dzaky123-tiktok-api.hf.space";
        
        // DOM Elements (Cached)
        const ui = {
            status: document.getElementById('serverStatus'),
            input: document.getElementById('tiktokUrl'),
            mainBtn: document.getElementById('downloadBtn'),
            mainBtnText: document.getElementById('btnText'),
            mainBtnLoader: document.getElementById('btnLoader'),
            error: document.getElementById('errorMessage'),
            errorText: document.getElementById('errorText'),
            resultContainer: document.getElementById('resultContainer'),
            skeleton: document.getElementById('skeletonLoader'),
            content: document.getElementById('resultContent'),
            thumb: document.getElementById('videoThumb'),
            title: document.getElementById('videoTitle'),
            author: document.getElementById('videoAuthor'),
            proxyBtn: document.getElementById('proxyDownloadBtn'),
            proxyBtnText: document.getElementById('proxyBtnText'),
            proxyBtnLoader: document.getElementById('proxyBtnLoader'),
            fallback: document.getElementById('fallbackLink')
        };

        // --- Server Check ---
        async function checkServer() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                if (response.ok) setServerOnline();
                else throw new Error("Server error");
            } catch (e) {
                setServerOffline();
            }
        }

        function setServerOnline() {
            ui.status.innerHTML = `<div class="w-2 h-2 rounded-full bg-green-500"></div><span class="text-green-500 font-medium">Ready</span>`;
            ui.status.className = "flex items-center gap-2 px-3 py-1 rounded-full bg-green-950/30 border border-green-900/50 text-xs";
            
            ui.mainBtn.disabled = false;
            ui.mainBtn.className = "w-full py-3 px-4 bg-white hover:bg-neutral-200 text-black rounded-lg font-bold text-sm transition-colors flex items-center justify-center gap-2 cursor-pointer shadow";
            ui.mainBtnText.innerText = "Cari Video";
        }

        function setServerOffline() {
            ui.status.innerHTML = `<div class="w-2 h-2 rounded-full bg-red-500"></div><span class="text-red-500 font-medium">Offline</span>`;
            ui.status.className = "flex items-center gap-2 px-3 py-1 rounded-full bg-red-950/30 border border-red-900/50 text-xs";
            
            ui.mainBtn.disabled = true;
            ui.mainBtn.className = "w-full py-3 px-4 bg-neutral-800 text-neutral-500 rounded-lg font-semibold text-sm transition-all flex items-center justify-center gap-2 cursor-not-allowed";
            ui.mainBtnText.innerText = "Connecting...";
            setTimeout(checkServer, 5000);
        }

        // --- Paste ---
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                if (text) ui.input.value = text;
            } catch (err) {
                // Fail silently or focus input
                ui.input.focus();
            }
        }

        // --- Process ---
        async function processVideo() {
            const url = ui.input.value.trim();
            resetUI();
            
            if (!url) return showError("Masukkan URL dulu.");

            setLoading(true);
            ui.resultContainer.classList.remove('hidden');
            ui.skeleton.classList.remove('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/process`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.detail || 'Gagal.');

                showResult(data.data);
            } catch (error) {
                ui.resultContainer.classList.add('hidden');
                showError("Gagal memproses. Cek koneksi / URL.");
            } finally {
                setLoading(false);
                ui.skeleton.classList.add('hidden');
            }
        }

        // --- Download ---
        function downloadViaProxy() {
            const url = ui.input.value.trim();
            ui.proxyBtn.disabled = true;
            ui.proxyBtnText.classList.add('hidden');
            ui.proxyBtnLoader.classList.remove('hidden');
            ui.fallback.classList.add('hidden');

            const downloadUrl = `${API_BASE_URL}/api/download?url=${encodeURIComponent(url)}`;
            
            setTimeout(() => {
                window.location.href = downloadUrl;
                setTimeout(() => {
                    ui.proxyBtn.disabled = false;
                    ui.proxyBtnText.classList.remove('hidden');
                    ui.proxyBtnLoader.classList.add('hidden');
                    ui.fallback.classList.remove('hidden');
                }, 4000);
            }, 300);
        }

        // --- Helpers ---
        function showResult(data) {
            ui.thumb.src = data.thumbnail;
            ui.title.innerText = data.title;
            ui.author.innerText = '@' + (data.author || 'User');
            if(data.original_url) ui.fallback.href = data.original_url;
            ui.content.classList.remove('hidden');
        }

        function resetUI() {
            ui.error.classList.add('hidden');
            ui.content.classList.add('hidden');
            ui.skeleton.classList.add('hidden');
            ui.resultContainer.classList.add('hidden');
        }

        function setLoading(isLoading) {
            if (isLoading) {
                ui.mainBtn.disabled = true;
                ui.mainBtnText.classList.add('hidden');
                ui.mainBtnLoader.classList.remove('hidden');
            } else {
                ui.mainBtn.disabled = false;
                ui.mainBtnText.classList.remove('hidden');
                ui.mainBtnLoader.classList.add('hidden');
            }
        }

        function showError(msg) {
            ui.errorText.innerText = msg;
            ui.error.classList.remove('hidden');
        }

        checkServer();
    </script>
</body>
</html>
